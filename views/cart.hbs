<script>
    // do we want the van to be removed when submitting order ?
    function saveItems(){
        // redirect to home page if customer has not chosen a van
        if (sessionStorage.getItem("current_van") === null){
            console.log('sessionstorage 0')
            document.getElementById('submit_button').value = 'CHOOSE A VAN'
            location.replace('/customer/')
        }
        else{ // if customer has chosen a van, pass the key & value pair frm session storage to the controller
        console.log(sessionStorage.getItem("current_van"))
        document.getElementById("current_van").value = JSON.parse(JSON.stringify(sessionStorage.getItem("current_van")));
        console.log(document.getElementById("current_van").value)

        document.getElementById("van_form").submit();
        // sessionStorage.removeItem("current_van")
        // sessionStorage.clear();
        }
                    
    }

</script>

{{! view customer order}}
<section id = "currentCart">
    <center>
    <h1>Cart List</h1>
    {{#if loggedin}}<a href="/customer/order-history">View Order History</a></center>
    <div class= "cart-page">
        {{#if total}}
        <table>
            <tr><th>Selected Van: <span id="van_name"></span> </th><th><th></th></th></tr>
            <tr> 
                <th>Product</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                
            </tr>
            {{#each cart}}
            {{#if this.quantity}}
            <tr>
                <td>
                    <div class="cart-info">
                        <img class="currentCart" src="https://source.unsplash.com/{{this.snackId.photo}}" alt="hosted by Unsplash">
                        <div>
                            <p>{{this.snackId.name}}</p>
                            <small>Price: ${{this.snackId.price}}</small>
                        </div>
                    </div>
                </td>
                <td>{{this.quantity}}</td>
                <td>{{multiply this.snackId.price this.quantity}}</td>
                  
            </tr>
            {{/if}}
            {{/each}}
        </table>
        {{else}}
        <p>Your cart is empty</p>
        {{/if}}
    </div>
    {{#if total}}
    <div class="total-price">
        <table>
            <tr>
                <td><b>Total Price</b></td>
                <td>${{total}}</td>
            </tr>
            <tr>
                <td> <button onclick="location.href = '/customer/snacks'">CHANGE ORDER</button></td>
                <td><form method="post" action="/customer/order-details" id="van_form">
                    <input type="hidden" name="current_van" id = "current_van"/>
                    <input id ="submit_button" type="submit" onclick = "saveItems()" value="CONFIRM ORDER"/>
                </form></td>
            </tr>
        </table>
    </div>
    {{/if}}
    {{else}}
    <p><a href="/customer/getLoginPage">Login to view order history</a></p>
    {{/if}}
</section>

<script>
// get van name from sessionstorage
if (window.sessionStorage.getItem('current_van') != null){
    document.getElementById('van_name').innerHTML = JSON.stringify(JSON.parse(window.sessionStorage.getItem('current_van')).name)
}
else{
    document.getElementById('van_name').innerHTML = '<a href="/customer/">Please select a van</a>'
}

// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>